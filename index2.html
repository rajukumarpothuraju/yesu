<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz & Prayer Requests</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-3">
  <h1 class="text-center mb-4">ğŸ“Š Quiz Results</h1>
  <table class="table table-bordered mb-5">
    <thead>
      <tr>
        <th>à°ªà±‡à°°à±</th>
        <th>à°Šà°°à±</th>
        <th>Email</th>
        <th>Score</th>
        <th>Submitted At</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="resultsTable"></tbody>
  </table>

  <!-- ğŸ†• Prayer Requests Table -->
  <h1 class="text-center mb-4">ğŸ™ Prayer Requests</h1>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>à°ªà±‡à°°à±</th>
        <th>à°ªà±à°°à°¾à°°à±à°¥à°¨ à°…à°µà°¸à°°à°‚</th>
        <th>à°ªà°‚à°ªà°¿à°¨ à°¸à°®à°¯à°‚</th>
        <th>à°¸à±à°¥à°¿à°¤à°¿</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="prayerTable"></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    // âœ… Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyD9juuO9qTf66xywHKZvVraDVYIOo0XABw",
      authDomain: "new-bible-quiz-app.firebaseapp.com",
      databaseURL: "https://new-bible-quiz-app-default-rtdb.firebaseio.com",
      projectId: "new-bible-quiz-app",
      storageBucket: "new-bible-quiz-app.appspot.com",
      messagingSenderId: "686170969568",
      appId: "1:686170969568:web:31d3e10ed615dba548c785"
    };

    // âœ… Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ğŸ”¥ Delete functions
    function deleteUser(uid) {
      if (confirm("âŒ à°ˆ user data à°¨à°¿ delete à°šà±‡à°¯à°¾à°²à°¾?")) {
        remove(ref(db, 'usersData/' + uid))  // ğŸ”¥ changed here
          .then(() => alert("âœ… Deleted Successfully"))
          .catch(err => alert("âŒ Error: " + err.message));
      }
    }

    function deletePrayer(id) {
      if (confirm("âŒ à°ˆ prayer request à°¨à°¿ delete à°šà±‡à°¯à°¾à°²à°¾?")) {
        remove(ref(db, 'prayerRequests/' + id))
          .then(() => alert("âœ… Prayer Deleted"))
          .catch(err => alert("âŒ Error: " + err.message));
      }
    }

    // âœ… Fetch users (fullName, village, email, score)
    const usersRef = ref(db, 'usersData'); // ğŸ”¥ changed here
    onValue(usersRef, (snapshot) => {
      const data = snapshot.val();
      const tableBody = document.getElementById('resultsTable');
      tableBody.innerHTML = '';
      for (let uid in data) {
        const user = data[uid];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.fullName || '(à°ªà±‡à°°à± à°²à±‡à°¦à±)'}</td>
          <td>${user.village || '(à°Šà°°à± à°²à±‡à°¦à±)'}</td>
          <td>${user.email || '(Email à°²à±‡à°¦à±)'}</td>
          <td>${user.score || 0}</td>
          <td>${user.submittedAt || '-'}</td>
          <td><button class="btn btn-danger btn-sm" onclick="deleteUser('${uid}')">Delete</button></td>
        `;
        tableBody.appendChild(tr);
      }
    });

    // âœ… Fetch prayerRequests
    const prayerRef = ref(db, 'prayerRequests');
    onValue(prayerRef, (snapshot) => {
      const data = snapshot.val();
      const prayerBody = document.getElementById('prayerTable');
      prayerBody.innerHTML = '';
      for (let id in data) {
        const req = data[id];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${req.name || '(à°ªà±‡à°°à± à°²à±‡à°¦à±)'}</td>
          <td>${req.prayer || '(à°ªà±à°°à°¾à°°à±à°¥à°¨ à°²à±‡à°¦à±)'}</td>
          <td>${req.submittedAt || '-'}</td>
          <td>ğŸ™</td>
          <td><button class="btn btn-danger btn-sm" onclick="deletePrayer('${id}')">Delete</button></td>
        `;
        prayerBody.appendChild(tr);
      }
    });

    // ğŸ› ï¸ Expose delete functions to window
    window.deleteUser = deleteUser;
    window.deletePrayer = deletePrayer;
  </script>
</body>
</html>






